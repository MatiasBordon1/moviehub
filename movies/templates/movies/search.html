{% extends "movies/base.html" %}

{% block content %}
  <div class="container mt-4">
    <h1 class="mb-4 text-center">üé¨ Buscador de Pel√≠culas</h1>

    <form method="post" class="card p-4 shadow-sm mb-5">
      {% csrf_token %}

      <div class="mb-3">
        <input type="text" name="query" class="form-control form-control-lg"
               placeholder="üîé Ingres√° un t√≠tulo..." value="{{ request.POST.query }}">
      </div>

      <div class="row">
        <div class="col-md-4 mb-3">
          <input type="number" name="min_rating" class="form-control"
                 step="0.1" min="0" max="10"
                 placeholder="‚≠ê Puntaje m√≠nimo" value="{{ request.POST.min_rating }}">
        </div>

        <div class="col-md-4 mb-3">
          <input type="number" name="release_year" class="form-control"
                 placeholder="üìÖ A√±o de estreno (desde)" value="{{ request.POST.release_year }}">
        </div>

        <div class="col-md-4 mb-3">
          <select name="genre" class="form-select">
            <option value="">üé≠ Todos los g√©neros</option>
            <option value="28" {% if request.POST.genre == "28" %}selected{% endif %}>Acci√≥n</option>
            <option value="12" {% if request.POST.genre == "12" %}selected{% endif %}>Aventura</option>
            <option value="16" {% if request.POST.genre == "16" %}selected{% endif %}>Animaci√≥n</option>
            <option value="35" {% if request.POST.genre == "35" %}selected{% endif %}>Comedia</option>
            <option value="18" {% if request.POST.genre == "18" %}selected{% endif %}>Drama</option>
            <option value="27" {% if request.POST.genre == "27" %}selected{% endif %}>Terror</option>
            <option value="878" {% if request.POST.genre == "878" %}selected{% endif %}>Ciencia Ficci√≥n</option>
            <option value="10749" {% if request.POST.genre == "10749" %}selected{% endif %}>Romance</option>
          </select>
        </div>
      </div>

      <div class="text-center">
        <button type="submit" class="btn btn-primary btn-lg mt-3 px-5">üîç Buscar</button>
      </div>
    </form>

    {% if results %}
      <h2 class="mb-4 text-center">üéû Resultados</h2>

      <div class="row row-cols-1 row-cols-md-2 g-4">
        {% for movie in results %}
          <div class="col">
            <div class="card shadow-sm h-100">
              <div class="row g-0 h-100">
                <div class="col-md-4">
                  <img src="{{ movie.poster_url|default:'https://via.placeholder.com/150x225?text=Sin+Poster' }}"
                       class="img-fluid rounded-start h-100 object-fit-cover"
                       alt="{{ movie.title }}">
                </div>
                <div class="col-md-8">
                  <div class="card-body d-flex flex-column justify-content-between h-100">
                    <div>
                      <h5 class="card-title">{{ movie.title }} ({{ movie.release_date|slice:":4" }})</h5>
                      <p class="card-text small text-muted">{{ movie.overview }}</p>
                      <p class="card-text"><small class="text-body-secondary">‚≠ê {{ movie.rating }}</small></p>
                    </div>

                    <form method="post" action="{% url 'add_favorite' %}" class="mt-2">
                      {% csrf_token %}
                      <input type="hidden" name="tmdb_id" value="{{ movie.tmdb_id }}">
                      <input type="hidden" name="title" value="{{ movie.title }}">
                      <input type="hidden" name="overview" value="{{ movie.overview }}">
                      <input type="hidden" name="poster_url" value="{{ movie.poster_url }}">
                      <input type="hidden" name="release_date" value="{{ movie.release_date }}">
                      <input type="hidden" name="rating" value="{{ movie.rating }}">
                      <input type="hidden" name="genre_ids" value="{{ movie.genre_ids }}">
                      <button type="submit" class="btn btn-success btn-sm w-100 mt-2">
                        ‚ù§Ô∏è Agregar a Favoritos
                      </button>
                    </form>
                  </div>
                </div>
              </div>
            </div>
          </div>
        {% endfor %}
      </div>
    {% endif %}
  </div>
{% endblock %}
